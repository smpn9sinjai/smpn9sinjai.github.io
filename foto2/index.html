<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Kamera + Crop Gambar</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://unpkg.com/cropperjs/dist/cropper.min.css" rel="stylesheet">

<style>
body{font-family:Arial;padding:10px}
img{max-width:100%}
button{margin:5px;padding:8px}
#preview{margin-top:10px}
</style>
</head>
<body>

<h3>Ambil Foto & Crop</h3>

<input type="file" accept="image/*" capture="environment" id="cameraInput">

<br>
<img id="image">

<br>
<button onclick="cropImage()">Crop</button>

<div id="preview"></div>

<script src="https://unpkg.com/cropperjs/dist/cropper.min.js"></script>

 <script>
let cropper;

document.getElementById("cameraInput").addEventListener("change", e=>{
  const file = e.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = ()=>{
    const img = document.getElementById("image");

    if(cropper){
      cropper.destroy();
      cropper = null;
    }

    img.onload = () => {
      cropper = new Cropper(img,{
        viewMode: 1,
        dragMode: 'move',
        autoCropArea: 1,
        responsive: true,
        zoomable: true,
        scalable: false,
        cropBoxResizable: true,
        guides: true,
        center: true,
        highlight: true
      });
    };

    img.src = reader.result;
  };
  reader.readAsDataURL(file);
});

function cropImage(){
  if(!cropper){
    alert("Ambil foto dulu");
    return;
  }

  const canvas = cropper.getCroppedCanvas({
    width: 1200,
    imageSmoothingQuality: 'high'
  });

  document.getElementById("preview").innerHTML =
    `<h4>Hasil Crop</h4>
     <img src="${canvas.toDataURL('image/jpeg',0.85)}">`;
}
</script>


</body>
</html>
