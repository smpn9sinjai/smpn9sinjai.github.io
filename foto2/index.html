<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Kamera + Crop Stabil</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- CropperJS CSS -->
<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">

<style>
body {
  font-family: Arial;
  padding: 10px;
}
h3 {
  margin-bottom: 10px;
}
#imageContainer {
  width: 300px;        /* Lebar tampilan crop */
  height: 400px;       /* Tinggi tampilan crop */
  border: 1px solid #ccc;
  overflow: hidden;
  margin-top: 10px;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #f5f5f5;
}
#image {
  max-width: 100%;
  max-height: 100%;
  display: block;
  object-fit: contain; /* Tetap proporsional */
}
button {
  margin-top: 10px;
  padding: 8px 12px;
}
#preview img {
  max-width: 100%;
  margin-top: 10px;
  display: block;
}
</style>
</head>
<body>

<h3>Ambil Foto & Crop Stabil</h3>

<input type="file" accept="image/*" capture="environment" id="cameraInput">

<div id="imageContainer">
  <img id="image">
</div>

<button onclick="cropImage()">Crop</button>

<div id="preview"></div>

<!-- CropperJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>

<script>
let cropper;

const cameraInput = document.getElementById("cameraInput");
const image = document.getElementById("image");
const preview = document.getElementById("preview");

cameraInput.addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = () => {
    if (cropper) {
      cropper.destroy();
      cropper = null;
    }

    image.onload = () => {
      // Inisialisasi Cropper
      cropper = new Cropper(image, {
        viewMode: 1,
        autoCropArea: 1,
        movable: true,
        zoomable: true,
        cropBoxResizable: true,
        minContainerWidth: 300,
        minContainerHeight: 400,
        guides: true,
        center: true,
        highlight: true
      });
    };

    image.src = reader.result;
  };
  reader.readAsDataURL(file);
});

function cropImage() {
  if (!cropper) return alert("Ambil foto dulu");

  const canvas = cropper.getCroppedCanvas({
    width: 1200,
    height: 1600, // menyesuaikan rasio 3:4
    imageSmoothingQuality: 'high'
  });

  preview.innerHTML = `<h4>Hasil Crop</h4><img src="${canvas.toDataURL('image/jpeg',0.85)}">`;
}
</script>

</body>
</html>
