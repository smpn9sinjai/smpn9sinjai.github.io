<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Kamera + Crop</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">

<style>
body{font-family:Arial;padding:10px}
img{max-width:100%;display:block}
button{margin-top:10px;padding:8px}
</style>
</head>
<body>

<input type="file" accept="image/*" capture="environment" id="cameraInput">
<img id="image">
<button onclick="cropImage()">Crop</button>
<div id="preview"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>

<script>
let cropper;

cameraInput.onchange = e => {
  const file = e.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = () => {
    if(cropper) cropper.destroy();

    image.onload = () => {
      cropper = new Cropper(image,{
        viewMode:1,
        autoCropArea:1,
        movable:true,
        zoomable:true,
        cropBoxResizable:true
      });
    };

    image.src = reader.result;
  };
  reader.readAsDataURL(file);
};

function cropImage(){
  if(!cropper) return alert("Ambil foto dulu");

  const canvas = cropper.getCroppedCanvas({width:1200});
  preview.innerHTML = `<img src="${canvas.toDataURL('image/jpeg',0.85)}">`;
}
</script>

</body>
</html>
